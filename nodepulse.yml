# NodePulse Agent Configuration

server:
  # The endpoint to send metrics to
  endpoint: "https://ingest.dogfooding.nodepulse.sh"

  # HTTP request timeout
  # If the server doesn't respond within this time, the request fails
  # and the buffered report will be retried later
  timeout: 3s

agent:
  # Unique server ID (UUID format)
  # If not set or left as placeholder, a UUID will be auto-generated on first run
  # and saved to /var/lib/nodepulse/server_id for persistence
  # You can also manually set one: uuidgen (Linux/Mac) or New-Guid (PowerShell)
  server_id: "00000000-0000-0000-0000-000000000000"

  # Default metrics collection interval (used if exporter doesn't specify one)
  # Valid values: 15s, 30s, 1m
  interval: 15s

# Prometheus Exporters Configuration
# The agent supports multiple exporters running in parallel
exporters:
  # Node Exporter - System metrics (CPU, memory, disk, network)
  - name: node_exporter
    enabled: true
    endpoint: "http://localhost:9100/metrics"
    timeout: 3s

  # Example: PostgreSQL Exporter (uncomment to enable)
  # - name: postgres_exporter
  #   enabled: true
  #   endpoint: "http://localhost:9187/metrics"
  #   timeout: 5s

  # Example: MySQL Exporter (uncomment to enable)
  # - name: mysql_exporter
  #   enabled: true
  #   endpoint: "http://localhost:9104/metrics"
  #   timeout: 5s

  # Example: Redis Exporter (uncomment to enable)
  # - name: redis_exporter
  #   enabled: true
  #   endpoint: "http://localhost:9121/metrics"
  #   timeout: 3s

buffer:
  # Directory to store buffered reports
  # All metrics are buffered first (Write-Ahead Log pattern)
  # Structure: buffer/<exporter>/YYYYMMDD-HHMMSS-<server_id>.prom
  # Each exporter gets its own subdirectory for better organization
  # Background process sends buffered data with random jitter to distribute load
  path: "/var/lib/nodepulse/buffer"

  # How long to keep buffered reports (in hours)
  # Files older than this are automatically deleted
  retention_hours: 48

  # Number of reports to send per batch request
  # Higher values = fewer HTTP requests, larger payloads
  # Default: 5
  batch_size: 5

logging:
  # Log level: debug, info, warn, error
  # debug: Verbose diagnostic information for troubleshooting
  # info: General informational messages about normal operation
  # warn: Potentially harmful situations that don't prevent operation
  # error: Error events that might still allow operation to continue
  level: "info"

  # Log output destination: stdout, file, both
  # stdout: Output to console/terminal
  # file: Write to log file with rotation
  # both: Output to both console and file
  output: "stdout"

  # File logging configuration (used when output is "file" or "both")
  file:
    # Path to the log file
    path: "/var/log/nodepulse/agent.log"

    # Maximum size in MB before rotating
    max_size_mb: 10

    # Maximum number of old log files to keep
    max_backups: 3

    # Maximum number of days to keep old log files
    max_age_days: 7

    # Compress rotated log files with gzip
    compress: true
